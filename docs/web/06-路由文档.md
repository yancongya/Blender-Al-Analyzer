# Web 路由文档

## 路由概述

Web 前端使用 Vue Router 进行路由管理，路由配置位于 `src/router/index.ts`。

## 路由配置

### 路由列表

| 路径 | 名称 | 组件 | 功能 |
|------|------|------|------|
| `/` | Root | ChatLayout | 根路径，重定向到 /chat |
| `/chat/:uuid?` | Chat | views/chat/index.vue | 聊天界面 |
| `/404` | 404 | views/exception/404/index.vue | 404 页面 |
| `/500` | 500 | views/exception/500/index.vue | 500 页面 |
| `/:pathMatch(.*)*` | notFound | - | 未匹配路径，重定向到 /404 |

### 路由结构

```typescript
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Root',
    component: ChatLayout,
    redirect: '/chat',
    children: [
      {
        path: '/chat/:uuid?',
        name: 'Chat',
        component: () => import('@/views/chat/index.vue'),
      },
    ],
  },
  {
    path: '/404',
    name: '404',
    component: () => import('@/views/exception/404/index.vue'),
  },
  {
    path: '/500',
    name: '500',
    component: () => import('@/views/exception/500/index.vue'),
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'notFound',
    redirect: '/404',
  },
]
```

---

## 路由模式

### Hash 模式

```typescript
export const router = createRouter({
  history: createWebHashHistory(),
  routes,
  scrollBehavior: () => ({ left: 0, top: 0 }),
})
```

**特点**：
- URL 包含 `#` 符号
- 兼容性好
- 不需要服务器配置

**示例**：
```
http://localhost:3000/#/chat/123
```

---

## 路由守卫

### 页面守卫

**文件**：`src/router/permission.ts`

**功能**：路由权限控制。

```typescript
export function setupPageGuard(router: Router) {
  router.beforeEach((to, from, next) => {
    // 权限检查逻辑
    next()
  })
}
```

### 使用示例

```typescript
import { setupPageGuard } from './permission'

setupPageGuard(router)
```

---

## 路由参数

### 动态参数

```typescript
{
  path: '/chat/:uuid?',
  name: 'Chat',
  component: () => import('@/views/chat/index.vue'),
}
```

**获取参数**：

```typescript
import { useRoute } from 'vue-router'

const route = useRoute()
const uuid = route.params.uuid
```

### 查询参数

```typescript
// URL: /chat/123?tab=settings
const query = route.query
const tab = query.tab // 'settings'
```

---

## 路由导航

### 编程式导航

```typescript
import { useRouter } from 'vue-router'

const router = useRouter()

// 导航到指定路径
router.push('/chat/123')

// 导航到命名路由
router.push({ name: 'Chat', params: { uuid: 123 } })

// 带查询参数
router.push({ path: '/chat/123', query: { tab: 'settings' } })

// 替换当前路由
router.replace('/chat/456')

// 后退
router.go(-1)
```

### 声明式导航

```vue
<template>
  <router-link to="/chat/123">聊天</router-link>
  
  <router-link :to="{ name: 'Chat', params: { uuid: 123 } }">
    聊天
  </router-link>
</template>
```

---

## 路由组件

### RouterView

```vue
<template>
  <RouterView />
</template>
```

### 嵌套路由

```typescript
{
  path: '/',
  component: Layout,
  children: [
    {
      path: 'chat',
      component: Chat
    }
  ]
}
```

```vue
<!-- Layout.vue -->
<template>
  <div>
    <Header />
    <RouterView />
    <Footer />
  </div>
</template>
```

---

## 路由元信息

### 定义元信息

```typescript
{
  path: '/chat/:uuid?',
  name: 'Chat',
  component: () => import('@/views/chat/index.vue'),
  meta: {
    title: '聊天',
    requiresAuth: true,
    icon: 'ri:chat-3-line'
  }
}
```

### 访问元信息

```typescript
import { useRoute } from 'vue-router'

const route = useRoute()
const meta = route.meta
console.log(meta.title) // '聊天'
```

---

## 路由懒加载

### 基本用法

```typescript
{
  path: '/chat',
  component: () => import('@/views/chat/index.vue')
}
```

### 魔法注释

```typescript
{
  path: '/chat',
  component: () => import(/* webpackChunkName: "chat" */ '@/views/chat/index.vue')
}
```

---

## 路由过渡

### 基本过渡

```vue
<template>
  <router-view v-slot="{ Component }">
    <transition name="fade" mode="out-in">
      <component :is="Component" />
    </transition>
  </router-view>
</template>

<style>
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
</style>
```

---

## 路由错误处理

### 导航失败

```typescript
router.push('/chat/123').catch((error) => {
  if (error.name === 'NavigationDuplicated') {
    // 忽略重复导航
    return
  }
  console.error('导航失败:', error)
})
```

### 全局错误处理

```typescript
router.onError((error) => {
  console.error('路由错误:', error)
})
```

---

## 路由最佳实践

1. **命名规范**：使用 PascalCase 命名路由
2. **懒加载**：使用动态导入减少初始加载
3. **元信息**：使用 meta 存储路由相关信息
4. **守卫**：使用路由守卫进行权限控制
5. **错误处理**：处理导航失败和路由错误
6. **滚动行为**：配置合适的滚动行为
7. **类型安全**：使用 TypeScript 定义路由类型

---

## 路由文档索引

- [01-主界面文档](./01-主界面文档.md)
- [02-组件文档](./02-组件文档.md)
- [03-Store 文档](./03-Store文档.md)
- [04-API 文档](./04-API文档.md)
- [05-Hooks 文档](./05-Hooks文档.md)
- [06-路由文档](./06-路由文档.md)