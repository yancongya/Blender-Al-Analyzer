# 快速复制面板文档 (NODE_PT_quick_copy)

## 面板信息

| 属性 | 值 |
|------|-----|
| 类名 | `NODE_PT_quick_copy` |
| 标签 | "快速复制" |
| 空间类型 | `NODE_EDITOR` |
| 区域类型 | `UI` |
| 分类 | "AI Node Analyzer" |
| 选项 | `{'DEFAULT_CLOSED'}` |

## 面板结构

面板使用 2x2 网格布局，显示 4 个文本部分的切换按钮。

### 组件

| 位置 | 组件 | 图标 | 文本 | 功能 |
|------|------|------|------|------|
| 第一行左侧 | 输出详细程度按钮 | `OUTPUT` | 输出 | 切换选中 "输出详细程度提示词" 部分 |
| 第一行右侧 | 系统提示词按钮 | `USER` | 用户 | 切换选中 "系统提示词" 部分 |
| 第二行左侧 | 用户问题按钮 | `QUESTION` | 问题 | 切换选中 "用户问题" 部分 |
| 第二行右侧 | 节点数据按钮 | `NODETREE` | 节点 | 切换选中 "节点数据" 部分 |

### 复制按钮

| 组件 | 图标 | 文本 | 功能 |
|------|------|------|------|
| 复制按钮 | `COPY_ID` | 复制选中部分 | 复制所有选中的文本部分到剪贴板 |

## 文本部分映射

| 部分 | 文本块名称 |
|------|-----------|
| `output_detail` | `01-输出详细程度提示词` |
| `system_prompt` | `02-系统提示词` |
| `user_question` | `03-用户问题` |
| `node_data` | `04-节点数据` |

## 代码位置

`__init__.py` 第 899-936 行

```python
class NODE_PT_quick_copy(Panel):
    bl_label = "快速复制"
    bl_idname = "NODE_PT_quick_copy"
    bl_space_type = 'NODE_EDITOR'
    bl_region_type = 'UI'
    bl_category = "AI Node Analyzer"
    bl_options = {'DEFAULT_CLOSED'}

    def draw(self, context):
        layout = self.layout
        ain_settings = context.scene.ainode_analyzer_settings

        # 显示4个部分的图标+文本按钮 - 平均排布
        # 使用2x2网格布局
        col = layout.column(align=True)
        
        # 检查每个部分是否被选中
        selected_parts = {item.part_name for item in ain_settings.selected_text_parts}
        
        # 第一行：输出详细程度 + 系统提示词
        row1 = col.row(align=True)
        row1.scale_x = 1.0
        row1.scale_y = 1.2
        
        # 输出详细程度提示词
        op1 = row1.operator("node.copy_text_part", text="输出", icon='OUTPUT', depress=('output_detail' in selected_parts))
        op1.part = 'output_detail'
        
        # 系统提示词
        op2 = row1.operator("node.copy_text_part", text="用户", icon='USER', depress=('system_prompt' in selected_parts))
        op2.part = 'system_prompt'
        
        # 第二行：用户问题 + 节点数据
        row2 = col.row(align=True)
        row2.scale_x = 1.0
        row2.scale_y = 1.2
        
        # 用户问题
        op3 = row2.operator("node.copy_text_part", text="问题", icon='QUESTION', depress=('user_question' in selected_parts))
        op3.part = 'user_question'
        
        # 节点数据
        op4 = row2.operator("node.copy_text_part", text="节点", icon='NODETREE', depress=('node_data' in selected_parts))
        op4.part = 'node_data'

        # 复制按钮
        layout.separator()
        copy_row = layout.row()
        copy_row.alignment = 'CENTER'
        copy_row.scale_y = 1.2
        copy_row.operator("node.copy_active_text", text="复制选中部分", icon='COPY_ID')
        
        # 显示当前选中的部分数量
        selected_count = len(ain_settings.selected_text_parts)
        if selected_count > 0:
            layout.separator()
            info_row = layout.row()
            info_row.alignment = 'CENTER'
            info_row.label(text=f"已选中 {selected_count} 个部分")
```

## 交互方式

### 左键点击

切换文本部分的选中状态：
- 如果未选中，则添加到选中列表
- 如果已选中，则从选中列表移除

### Shift + 点击

直接复制该部分的文本内容到剪贴板

## 相关运算符

| 运算符 | 功能 |
|--------|------|
| `node.copy_text_part` | 切换文本部分选择 / 复制单个部分 |
| `node.copy_active_text` | 复制所有选中的文本部分 |

## 相关属性

| 属性 | 类型 | 描述 |
|------|------|------|
| `selected_text_parts` | CollectionProperty | 当前选中的文本部分集合 |

## 使用示例

### 示例 1：选择并复制多个部分

1. 点击 "输出" 按钮（选中输出详细程度提示词）
2. 点击 "用户" 按钮（选中系统提示词）
3. 点击 "节点" 按钮（选中节点数据）
4. 点击 "复制选中部分" 按钮
5. 剪贴板将包含所有三个部分的内容

### 示例 2：快速复制单个部分

按住 Shift 键，然后点击 "问题" 按钮，立即复制用户问题到剪贴板。

### 示例 3：取消选择

再次点击已选中的按钮，即可取消该部分的选择。

## 输出格式

当复制多个部分时，输出格式如下：

```
=== output_detail ===
输出详细程度提示词内容

=== system_prompt ===
系统提示词内容

=== node_data ===
节点数据内容
```

## 注意事项

1. 文本块必须存在才能复制，如果文本块不存在或为空，则不会复制该部分
2. 按钮的 `depress` 属性用于显示选中状态
3. 选中状态保存在 `selected_text_parts` 集合中