# ä¸»é¢æ¿æ–‡æ¡£ (NODE_PT_ai_analyzer)

## é¢æ¿ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|-----|
| ç±»å | `NODE_PT_ai_analyzer` |
| æ ‡ç­¾ | "AIèŠ‚ç‚¹åˆ†æå™¨" |
| ç©ºé—´ç±»å‹ | `NODE_EDITOR` |
| åŒºåŸŸç±»å‹ | `UI` |
| åˆ†ç±» | "AI Node Analyzer" |

## é¢æ¿ç»“æ„

ä¸»é¢æ¿åˆ†ä¸ºä¸‰ä¸ªä¸»è¦åŒºåŸŸï¼š

1. **é¡¶éƒ¨çŠ¶æ€ä¿¡æ¯è¡Œ**
2. **åç«¯æœåŠ¡å™¨è¡Œ**
3. **äº¤äº’å¼æ–‡æ¡£é¢æ¿ç»„**

## 1. é¡¶éƒ¨çŠ¶æ€ä¿¡æ¯è¡Œ

### åŠŸèƒ½è¯´æ˜

æ˜¾ç¤ºå½“å‰èŠ‚ç‚¹ç±»å‹å’Œå¿«é€Ÿæ“ä½œæŒ‰é’®ã€‚

### ç»„ä»¶

| ç»„ä»¶ | å›¾æ ‡ | åŠŸèƒ½ |
|------|------|------|
| èŠ‚ç‚¹ç±»å‹æ˜¾ç¤º | æ—  | æ˜¾ç¤ºå½“å‰èŠ‚ç‚¹ç¼–è¾‘å™¨ç±»å‹ï¼ˆå‡ ä½•èŠ‚ç‚¹ã€æè´¨èŠ‚ç‚¹ç­‰ï¼‰ |
| èº«ä»½é¢„è®¾ä¸‹æ‹‰èœå• | `USER` | é€‰æ‹© AI èº«ä»½é¢„è®¾ |
| ç®€åŒ–UIæŒ‰é’® | `HIDE_OFF` / `HIDE_ON` | åˆ‡æ¢ç®€åŒ– UI æ¨¡å¼ |
| å¸®åŠ©æç¤ºå¼€å…³ | `QUESTION` / `INFO` | æ˜¾ç¤º/éšè—å¸®åŠ©æç¤ºä¿¡æ¯ |
| åŠ è½½é…ç½®æŒ‰é’® | `FILE_REFRESH` | ä»æ–‡ä»¶åŠ è½½é…ç½® |
| è®¾ç½®æŒ‰é’® | `SETTINGS` | æ‰“å¼€è®¾ç½®å¼¹çª— |

### ä»£ç ä½ç½®

`__init__.py` ç¬¬ 839-898 è¡Œ

```python
# é¡¶éƒ¨çŠ¶æ€ä¿¡æ¯è¡Œ
top_row = layout.row(align=True)
node_type_display = "æœªçŸ¥"
# ... è·å–èŠ‚ç‚¹ç±»å‹ ...

# æ˜¾ç¤ºå½“å‰èŠ‚ç‚¹ç±»å‹
top_row.label(text=f"èŠ‚ç‚¹: {node_type_display}")
top_row.separator(factor=1.0)

# èº«ä»½è®¾ç½®ä¸‹æ‹‰èœå•
top_row.prop(ain_settings, "identity_key", text="", icon='USER')
top_row.separator(factor=1.0)

# ç®€åŒ–UIå¤é€‰æŒ‰é’®
top_row.prop(ain_settings, "simplified_ui", text="", icon='HIDE_OFF' if ain_settings.simplified_ui else 'HIDE_ON')
top_row.prop(ain_settings, "show_help_text", text="", icon='QUESTION' if ain_settings.show_help_text else 'INFO')
top_row.separator(factor=1.0)

# æ“ä½œæŒ‰é’®åŒºåŸŸ
top_row.operator("node.load_config_from_file", text="", icon='FILE_REFRESH')
top_row.operator("node.settings_popup", text="", icon='SETTINGS')
```

## 2. åç«¯æœåŠ¡å™¨è¡Œ

### åŠŸèƒ½è¯´æ˜

æ§åˆ¶åç«¯æœåŠ¡å™¨çš„å¯åŠ¨/åœæ­¢å’Œè®¿é—®ã€‚

### ç»„ä»¶

| ç»„ä»¶ | å›¾æ ‡ | åŠŸèƒ½ |
|------|------|------|
| æœåŠ¡å™¨æ ‡é¢˜ | `WORLD` | æ˜¾ç¤º "åç«¯æœåŠ¡å™¨" æ ‡é¢˜ |
| å¯åŠ¨/åœæ­¢æŒ‰é’® | `PLAY` / `PAUSE` | å¯åŠ¨æˆ–åœæ­¢åç«¯æœåŠ¡å™¨ |
| ç«¯å£è¾“å…¥æ¡† | æ—  | è®¾ç½®åç«¯æœåŠ¡å™¨ç«¯å£ |
| æ‰“å¼€ç½‘é¡µæŒ‰é’® | `URL` | åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åç«¯ç½‘é¡µç•Œé¢ |

### ä»£ç ä½ç½®

`__init__.py` ç¬¬ 900-910 è¡Œ

```python
backend_box = layout.box()
backend_box.label(text="åç«¯æœåŠ¡å™¨", icon='WORLD')

server_row = backend_box.row(align=True)
server_row.operator("node.toggle_backend_server", text="", icon='PLAY' if not (server_manager and server_manager.is_running) else 'PAUSE')
server_row.prop(ain_settings, "backend_port", text="ç«¯å£")
server_row.operator("node.open_backend_webpage", text="", icon='URL')
```

## 3. äº¤äº’å¼æ–‡æ¡£é¢æ¿ç»„

### åŠŸèƒ½è¯´æ˜

æ ¹æ® UI æ¨¡å¼æ˜¾ç¤ºä¸åŒçš„ç•Œé¢ã€‚

### 3.1 ç®€åŒ–æ¨¡å¼

å½“ `simplified_ui` ä¸º `True` æ—¶æ˜¾ç¤ºã€‚

#### ç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| é—®é¢˜è¾“å…¥æ¡† | è¾“å…¥ç”¨æˆ·é—®é¢˜ |
| æ¸…é™¤æŒ‰é’® | æ¸…ç©ºé—®é¢˜è¾“å…¥æ¡† |
| åˆ·æ–°æŒ‰é’® | åˆ·æ–°èŠ‚ç‚¹æ•°æ®åˆ°æ–‡æœ¬ç¼–è¾‘å™¨ |
| æé—®/ç»ˆæ­¢æŒ‰é’® | æäº¤é—®é¢˜æˆ–ç»ˆæ­¢å½“å‰è¯·æ±‚ |
| çŠ¶æ€æ˜¾ç¤º | æ˜¾ç¤ºå½“å‰çŠ¶æ€ï¼ˆå°±ç»ª/æ­£åœ¨å›ç­”/å·²ç»ˆæ­¢/é”™è¯¯ï¼‰ |

#### ä»£ç ä½ç½®

`__init__.py` ç¬¬ 912-945 è¡Œ

```python
if ain_settings.simplified_ui:
    # é—®é¢˜è¾“å…¥è¡Œ
    input_row = bottom_box.row(align=True)
    input_row.prop(ain_settings, "user_input", text="")
    input_row.operator("node.clear_question", text="", icon='TRASH')
    input_row.operator("node.refresh_to_text", text="", icon='FILE_REFRESH')

    # æé—®æŒ‰é’®å•ç‹¬ä¸€è¡Œ
    ask_row = bottom_box.row()
    ask_row.scale_y = 1.5

    if ain_settings.ai_question_status == 'PROCESSING':
        ask_row.operator("node.stop_ai_request", text="ç»ˆæ­¢å›ç­”", icon='X')
    else:
        ask_row.operator("node.ask_ai", text="æé—®", icon='PLAY')

    # æ˜¾ç¤ºå½“å‰çŠ¶æ€
    status_text = {
        'IDLE': "å°±ç»ª",
        'PROCESSING': "æ­£åœ¨å›ç­”...",
        'STOPPED': "å·²ç»ˆæ­¢",
        'ERROR': "é”™è¯¯"
    }.get(ain_settings.ai_question_status, "æœªçŸ¥çŠ¶æ€")

    status_row = bottom_box.row()
    status_row.label(text=f"çŠ¶æ€: {status_text}")
```

### 3.2 æ ‡å‡†æ¨¡å¼

å½“ `simplified_ui` ä¸º `False` æ—¶æ˜¾ç¤ºã€‚

#### ç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| æ ‡é¢˜è¡Œ | æ˜¾ç¤º "äº¤äº’å¼é—®ç­”" æ ‡é¢˜å’Œåˆ†ææ¡†æ¶æŒ‰é’® |
| é—®é¢˜è¾“å…¥æ¡† | è¾“å…¥ç”¨æˆ·é—®é¢˜ |
| æ¸…é™¤æŒ‰é’® | æ¸…ç©ºé—®é¢˜è¾“å…¥æ¡† |
| åˆ·æ–°æŒ‰é’® | åˆ·æ–°èŠ‚ç‚¹æ•°æ®åˆ°æ–‡æœ¬ç¼–è¾‘å™¨ |
| é»˜è®¤é—®é¢˜ä¸‹æ‹‰èœå• | é€‰æ‹©é»˜è®¤é—®é¢˜é¢„è®¾ |
| èŠ‚ç‚¹ç²¾ç»†åº¦ | è®¾ç½®èŠ‚ç‚¹ä¿¡æ¯è¯¦å°½ç¨‹åº¦ï¼ˆæç®€/ç®€åŒ–/å¸¸è§„/å®Œæ•´ï¼‰ |
| å›ç­”ç²¾ç»†åº¦ | è®¾ç½® AI å›ç­”è¯¦ç»†ç¨‹åº¦ï¼ˆç®€çº¦/é€‚ä¸­/è¯¦ç»†ï¼‰ |
| æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå• | é€‰æ‹© AI æ¨¡å‹ |
| æé—®/ç»ˆæ­¢æŒ‰é’® | æäº¤é—®é¢˜æˆ–ç»ˆæ­¢å½“å‰è¯·æ±‚ |
| çŠ¶æ€æ˜¾ç¤º | æ˜¾ç¤ºå½“å‰çŠ¶æ€ |
| å¸®åŠ©æç¤ºä¿¡æ¯ | æ˜¾ç¤ºä½¿ç”¨æç¤ºï¼ˆå¯æŠ˜å ï¼‰ |

#### ä»£ç ä½ç½®

`__init__.py` ç¬¬ 947-1010 è¡Œ

```python
else:
    # æ ‡é¢˜è¡Œ
    title_row = bottom_box.row()
    title_row.label(text="äº¤äº’å¼é—®ç­”", icon='QUESTION')
    title_row.operator("node.create_analysis_frame", text="", icon='FRAME_NEXT')

    # é—®é¢˜è¾“å…¥è¡Œ
    input_row = bottom_box.row(align=True)
    input_row.prop(ain_settings, "user_input", text="")
    input_row.operator("node.clear_question", text="", icon='TRASH')
    input_row.operator("node.refresh_to_text", text="", icon='FILE_REFRESH')

    # é»˜è®¤é—®é¢˜ä¸‹æ‹‰èœå•
    preset_row = bottom_box.row()
    preset_row.prop(ain_settings, "default_question_preset", text="é»˜è®¤é—®é¢˜")

    # ç²¾åº¦æ§åˆ¶è¡Œ
    detail_row = bottom_box.row(align=True)
    # èŠ‚ç‚¹ç²¾ç»†åº¦
    node_detail_subrow = detail_row.row(align=True)
    node_detail_subrow.prop(ain_settings, "node_detail_level", text=f"èŠ‚ç‚¹ç²¾ç»†åº¦({current_node_label})")
    copy_btn = node_detail_subrow.operator("node.copy_nodes_to_clipboard", text="", icon='COPY_ID')
    # å›ç­”ç²¾ç»†åº¦
    detail_row.prop(ain_settings, "response_detail_level", text=f"å›ç­”ç²¾ç»†åº¦({current_label}) - {preview_text}")

    # æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå•
    model_row = bottom_box.row()
    model_row.prop(ain_settings, "available_models", text="æ¨¡å‹")

    # æé—®æŒ‰é’®
    ask_row = bottom_box.row()
    ask_row.scale_y = 1.5
    if ain_settings.ai_question_status == 'PROCESSING':
        ask_row.operator("node.stop_ai_request", text="ç»ˆæ­¢å›ç­”", icon='X')
    else:
        ask_row.operator("node.ask_ai", text="æé—®", icon='PLAY')

    # æ˜¾ç¤ºå½“å‰çŠ¶æ€
    status_row = bottom_box.row()
    status_row.label(text=f"çŠ¶æ€: {status_text}")

    # å¸®åŠ©æç¤ºä¿¡æ¯
    if ain_settings.show_help_text:
        help_box = bottom_box.box()
        help_col = help_box.column(align=True)
        help_col.label(text="ğŸ’¡ ä½¿ç”¨æç¤º:", icon='INFO')
        help_col.label(text="â€¢ é€‰æ‹©èŠ‚ç‚¹åç‚¹å‡»'æé—®'å‘AIè¯¢é—®")
        help_col.label(text="â€¢ ä½¿ç”¨'åˆ†ææ¡†æ¶'ç¡®å®šåˆ†æèŒƒå›´")
        help_col.label(text="â€¢ å¯é€šè¿‡'ç®€åŒ–UI'æŒ‰é’®éšè—éå¿…è¦å…ƒç´ ")
```

## çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | æè¿° |
|------|------|
| `IDLE` | å°±ç»ªï¼Œç­‰å¾…ç”¨æˆ·æé—® |
| `PROCESSING` | AI æ­£åœ¨å¤„ç†é—®é¢˜ |
| `STOPPED` | å›ç­”å·²è¢«ç”¨æˆ·åœæ­¢ |
| `ERROR` | å‘ç”Ÿé”™è¯¯ |

## èŠ‚ç‚¹ç²¾ç»†åº¦çº§åˆ«

| çº§åˆ« | å€¼ | æè¿° |
|------|-----|------|
| æç®€ | 0 | ä»…æœ€å°æ ‡è¯† |
| ç®€åŒ– | 1 | ä¿ç•™å¿…è¦çš„ IO |
| å¸¸è§„ | 2 | æ¸…é™¤å¯è§†å±æ€§ |
| å®Œæ•´ | 3 | å®Œæ•´ä¸Šä¸‹æ–‡ |

## å›ç­”ç²¾ç»†åº¦çº§åˆ«

| çº§åˆ« | å€¼ | æè¿° |
|------|-----|------|
| ç®€çº¦ | 0 | ç®€è¦è¯´æ˜ï¼Œä¸éœ€è¦ markdown æ ¼å¼ |
| é€‚ä¸­ | 1 | æŒ‰å¸¸è§„æ–¹å¼å›ç­”ï¼Œä½¿ç”¨é€‚å½“çš„ markdown æ ¼å¼ |
| è¯¦ç»† | 2 | è¯¦ç»†è¯´æ˜ï¼Œä½¿ç”¨å›¾è¡¨ã€åˆ—è¡¨ã€ä»£ç å—ç­‰ markdown æ ¼å¼ |

## å¸®åŠ©æç¤ºä¿¡æ¯

å½“ `show_help_text` ä¸º `True` æ—¶æ˜¾ç¤ºä»¥ä¸‹æç¤ºï¼š

- é€‰æ‹©èŠ‚ç‚¹åç‚¹å‡»'æé—®'å‘ AI è¯¢é—®
- ä½¿ç”¨'åˆ†ææ¡†æ¶'ç¡®å®šåˆ†æèŒƒå›´
- å¯é€šè¿‡'ç®€åŒ– UI'æŒ‰é’®éšè—éå¿…è¦å…ƒç´ 

## ç›¸å…³è¿ç®—ç¬¦

| è¿ç®—ç¬¦ | åŠŸèƒ½ |
|--------|------|
| `node.load_config_from_file` | ä»æ–‡ä»¶åŠ è½½é…ç½® |
| `node.settings_popup` | æ‰“å¼€è®¾ç½®å¼¹çª— |
| `node.toggle_backend_server` | åˆ‡æ¢åç«¯æœåŠ¡å™¨ |
| `node.open_backend_webpage` | æ‰“å¼€åç«¯ç½‘é¡µ |
| `node.clear_question` | æ¸…é™¤é—®é¢˜ |
| `node.refresh_to_text` | åˆ·æ–°åˆ°æ–‡æœ¬ç¼–è¾‘å™¨ |
| `node.ask_ai` | å‘ AI æé—® |
| `node.stop_ai_request` | ç»ˆæ­¢ AI è¯·æ±‚ |
| `node.copy_nodes_to_clipboard` | å¤åˆ¶èŠ‚ç‚¹ä¿¡æ¯åˆ°å‰ªè´´æ¿ |
| `node.create_analysis_frame` | åˆ›å»ºåˆ†ææ¡†æ¶ |

## ç›¸å…³å±æ€§

| å±æ€§ | ç±»å‹ | æè¿° |
|------|------|------|
| `identity_key` | Enum | AI èº«ä»½é¢„è®¾ |
| `simplified_ui` | Bool | ç®€åŒ– UI æ¨¡å¼ |
| `show_help_text` | Bool | æ˜¾ç¤ºå¸®åŠ©æç¤º |
| `backend_port` | Int | åç«¯æœåŠ¡å™¨ç«¯å£ |
| `user_input` | String | ç”¨æˆ·è¾“å…¥æ–‡æœ¬ |
| `default_question_preset` | Enum | é»˜è®¤é—®é¢˜é¢„è®¾ |
| `node_detail_level` | Int | èŠ‚ç‚¹ç²¾ç»†åº¦ |
| `response_detail_level` | Int | å›ç­”ç²¾ç»†åº¦ |
| `available_models` | Enum | å¯ç”¨æ¨¡å‹åˆ—è¡¨ |
| `ai_question_status` | Enum | AI é—®ç­”çŠ¶æ€ |