## 目标
- 保持现有通信与功能完全不变（API、交互流程、按钮行为不变）。
- 全面现代化 UI：更清晰的布局、响应式适配、暗色主题、可访问性与细节动效。
- 前端代码结构更清晰：模块化 JS（无打包器）、可维护的样式体系（设计令牌与组件样式）。

## 现状概览
- 纯静态前端：`index.html` + `css/style.css` + `js/main.js`。
- 关键交互与通信：
  - API 基地址：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:2`
  - 历史记录拉取：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:28`
  - 测试连接：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:96`
  - 推送到 Blender：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:330`
  - 流式 AI 响应：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:218`
  - 事件绑定：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:372`
  - 键盘行为（Ctrl+Enter 发送）：`d:\blender\脚本制作\ainode\frontend\src\js\main.js:379`
- 布局：三栏面板（历史 / AI 响应 / 编辑），底部按钮与状态栏，样式使用原生 CSS。

## 设计与样式升级
- 设计令牌（CSS Variables）
  - 新增 `tokens.css`：颜色、间距、圆角、阴影、字体尺寸的统一变量。
  - 支持 `prefers-color-scheme` 自动暗色/亮色主题，手动开关覆盖。
- 组件样式与布局
  - 新增 `components.css`：按钮、面板、列表、滚动条、输入框的统一风格与状态（hover/focus-visible/disabled）。
  - 使用 CSS Grid 优化三栏布局，保留可调整宽度的历史面板；改善拖拽手柄的可见性与命中区。
  - 提升排版与可读性：系统字体栈、行高、段落间距；响应式断点在窄屏下切换为上下布局。
- 暗色主题
  - 新增 `theme.css`：通过变量切换主题，保证对比度与可访问性。

## 交互与可访问性升级
- 无功能改变前提下的增强：
  - 历史列表：当前项高亮、悬停提示、滚到选中项；保留点击填充行为 `d:\blender\脚本制作\ainode\frontend\src\js\main.js:44`。
  - 状态栏：增加状态图标/颜色，连接状态更直观。
  - 加载与空态：历史与响应区域在拉取/等待时显示骨架或提示文案，而不是“空白”。
  - 键盘与可访问性：为按钮与输入添加 ARIA 标签、`aria-live` 到响应容器；保留 Ctrl+Enter 发送的既有逻辑。
- 安全渲染
  - 将响应内容默认以文本方式插入（避免 HTML 注入），对明确的 Markdown/代码块做最小格式化；当前实现使用 `innerHTML`（如 `chunk` 渲染）会有注入风险 `d:\blender\脚本制作\ainode\frontend\src\js\main.js:295`，计划改为安全插入并仅对允许片段做格式。

## JS 模块化重构（无打包器）
- 切分为原生 ES Modules，并在 `index.html` 中使用 `type="module"` 引入：
  - `js/api.js`：封装现有 fetch 请求（测试连接、历史、清空、刷新、推送、流式响应），统一错误处理与状态更新。
  - `js/ui.js`：DOM 查询、事件绑定、状态栏与提示、骨架屏控制。
  - `js/render.js`：安全渲染响应（支持基本 Markdown 行内代码与代码块、自动滚动）。
  - `js/state.js`：轻量状态（当前历史项、原始节点数据、连接状态）。
  - `js/main.js`：保留原有入口语义，改为协调各模块；所有对外行为与按钮功能保持一致（事件源不变 `d:\blender\脚本制作\ainode\frontend\src\js\main.js:372`）。
- 不引入打包工具或重量级框架，确保易部署与原有行为稳定。

## HTML 结构细化（保持大体结构）
- 增加语义标签与辅助属性：
  - 为 `responseContainer` 增加 `role="region" aria-live="polite"`，提升读屏体验 `d:\blender\脚本制作\ainode\frontend\src\index.html:26`。
  - 为按钮增加 `title` 与 `aria-label`，保留原 ID 与绑定。
- 主题与样式文件顺序：`tokens.css` → `theme.css` → `components.css` → 现有局部覆盖。

## 兼容性与约束
- 保持所有 API 路径与参数不变：`/api/get-messages`、`/api/clear-messages`、`/api/test-connection`、`/api/trigger-blender-refresh`、`/api/blender-data`、`/api/push-web-content`、`/api/stream-ai-response`。
- 保留当前快捷键与按钮行为，避免用户习惯破坏。
- 无外部依赖（可选项：如同意后可引入轻量 CDN 样式库，但默认不引入）。

## 验证与测试
- 连通性：启动后检查状态栏文案更新（测试连接）与历史加载正常。
- 功能回归：
  - 刷新 → 组合“节点数据/用户问题”逻辑保持一致 `d:\blender\脚本制作\ainode\frontend\src\js\main.js:112-175`。
  - 发送 → 流式响应按 `start/progress/chunk/complete/error` 渲染并自动滚动 `d:\blender\脚本制作\ainode\frontend\src\js\main.js:284-310`。
  - 推送到 Blender → 状态提示与请求一致 `d:\blender\脚本制作\ainode\frontend\src\js\main.js:330-369`。
- 安全性：确认响应文本以安全方式插入，拒绝恶意 HTML 注入。
- 响应式：桌面与窄屏断点下布局与交互均可用。

## 交付内容
- 新增：`src/css/tokens.css`、`src/css/theme.css`、`src/css/components.css`、`src/js/api.js`、`src/js/ui.js`、`src/js/render.js`、`src/js/state.js`。
- 更新：`src/index.html`（语义与引入顺序）、`src/css/style.css`（仅保留必要覆盖）、`src/js/main.js`（模块化入口）。
- 说明文档：简短 README（结构说明与定制方法）。

## 后续可选增强（在功能保持前提下）
- 历史搜索与筛选、固定常用问题模板、响应内容一键复制。
- 主题定制（品牌色/暗色细化）、多语言文案抽取。

请确认以上方案；确认后我将按此计划实施并回归测试。